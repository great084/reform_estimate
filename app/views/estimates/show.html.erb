
顧客名：<%= @estimate.customer_name %>様 <br />
見積内容：<%= @estimate.subject %> <br />
小計：<%= @estimate.subtotal %> <br />
消費税：<%= @estimate.consumption_tax %> <br />
総計：<%= @estimate.grand_total %> <br />

<h2>カテゴリー
</h2>
<% if @estimate_categories && @active_category %>
  <ul id="categoriesTabs" class="nav nav-tabs justify-content-center">
    <% @estimate_categories.each_with_index do |ec, i| %>
      <%# binding.pry %>
      <% if ec == @active_category %>
        <li role="presentation" class="active">
          <%= link_to estimate_path(@estimate, estimate_category_id: ec.id) do %>
            <button aria-controls="spot-tab" role="tab" class="nav-link active"><%= ec.name %></button>
          <% end %>
        </li>
      <% else %>
        <li role="presentation">
          <%= link_to estimate_path(@estimate, estimate_category_id: ec.id)  do %>
            <button aria-controls="spot-tab" role="tab" class="nav-link "><%= ec.name %></button>
          <% end %>
        </li>
      <% end %>
    <% end %>
  </ul>
<% end %>

<table class="table table-list">
  <thead>
    <tr>
      <th>商品名</th>
      <th>仕様</th>
      <th>単位</th>
      <th>単価</th>
      <th>数量</th>
      <th>金額</th>
      <th>備考</th>
      <th>操作</th>
    </tr>
  </thead>

  <tbody>
  </tbody>
</table>

<% if @estimate_details %>
<% @estimate_details.each do |ed| %>
  <%= form_for(ed, url: estimate_detail_path(ed), method: :put) do |f| %>
    <div class="form-row">
        <%#= f.hidden_field :id %>
        <div class="form-group col-2">
          <%= f.text_field :item_name ,id: 'inputItemName', class: 'form-control'%>
        </div>
        <div class="form-group col-2">
          <%= f.text_field :specification, id: 'inputSpecification', class: 'form-control' %>
        </div>
        <div class="form-group col-1">
          <%= f.text_field :unit, id: 'inputUnit', class: 'form-control' %>
        </div>
        <div class="form-group col-1">
          <%= f.number_field :unit_price, id: 'inputUnitPrice', class: 'form-control' %>
        </div>
        <div class="form-group col-2">
          <%= f.text_field :remark, id: 'inputRemark', class: 'form-control' %>
        </div>
        <div class="form-group col-1">
          <%= f.submit '更新',  class: ' btn btn-primary btn-block ' %>
        </div>
        <div class="form-group col-1">
          <%= link_to '削除', estimate_detail_path(ed), method: :delete, class: 'btn btn-secondary btn-block ' %>
        </div>
    </div>
  <% end %>
<% end %>
<% end %>


  <%= form_for(@estimate_detail, url: estimate_details_path, method: :post) do |f| %>
    <div class="form-row">
        <%= f.hidden_field :estimate_category_id, value: @active_category.id %>
        <div class="form-group col-2">
          <%= f.collection_select :item_name, selectable_price_tables(@active_category.category), :item_name, :item_name, {}, class: 'form-control' %>
        </div>
        <div class="form-group col-2">
          <%= f.text_field :specification, id: 'inputSpecification', class: 'form-control' %>
        </div>
        <div class="form-group col-1">
          <%= f.text_field :unit, id: 'inputUnit', class: 'form-control' %>
        </div>
        <div class="form-group col-1">
          <%= f.number_field :unit_price, id: 'inputUnitPrice', class: 'form-control' %>
        </div>
        <div class="form-group col-1">
          <%= f.number_field :quantity, id: 'inputQuantity', class: 'form-control' %>
        </div>
        <div class="form-group col-1">
          <%= f.number_field :price, id: 'inputPrice', class: 'form-control', readonly: true %>
        </div>
        <div class="form-group col-2">
          <%= f.text_field :remark, id: 'inputRemark', class: 'form-control' %>
        </div>
        <div class="form-group col-2">
          <%= f.submit '新規登録',  class: ' btn btn-success btn-block' %>
        </div>
    </div>
  <% end %>


<% if @estimate_details %>
<% render partial: 'estimate_details/form', collection: @estimate_details, as: 'estimate_detail' %> 
<% @estimate_details.each do |ed|  %>
  <%= ed.id %>
  <%= ed.estimate_category_id %>
  <%=  ed.item_name %>
  <%=  ed.specification  %>
  <%= ed.unit  %>
  <%= ed.unit_price  %>
  <%= ed.quantity %>
  <%= ed.price %>
  <br>
<% end %>
<% end %>
